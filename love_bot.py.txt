import asyncio
from datetime import time
from telegram import Update, InputFile
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes

TOKEN = "8289400217:AAH2HYznYpuc-QOc4W8y0KrDpY_1rQfIbCY
"

PHOTO_PATH = "love_photo.jpg"

START_TEXT = (
    "–ö–∞—Ç—è ‚ù§Ô∏è\n\n"
    "–Ø ‚Äî –î–µ–Ω–∏—Å.\n"
    "–Ø –ª—é–±–ª—é —Ç–µ–±—è –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ üíûüíñ\n\n"
    "–Ø –Ω–∞–ø–∏—Å–∞–ª —ç—Ç–æ–≥–æ –±–æ—Ç–∞ —Ä–∞–¥–∏ —Ç–µ–±—è,\n"
    "—á—Ç–æ–±—ã –¥–∞–∂–µ –∫–æ–≥–¥–∞ –º–µ–Ω—è –Ω–µ—Ç —Ä—è–¥–æ–º,\n"
    "—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∑–Ω–∞–ª–∞,\n"
    "–∫–∞–∫ —Å–∏–ª—å–Ω–æ —Ç—ã –º–Ω–µ –¥–æ—Ä–æ–≥–∞ üíì\n\n"
    "–≠—Ç–æ—Ç –±–æ—Ç –±—É–¥–µ—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å\n"
    "–Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å —Ç–µ–±–µ –æ –º–æ–µ–π –ª—é–±–≤–∏,\n"
    "–∑–∞–±–æ—Ç–µ –∏ —Ç–µ–ø–ª–µ ‚ù§Ô∏è\n\n"
    "–ü–æ–º–Ω–∏:\n"
    "—è –≤—Å–µ–≥–¥–∞ –¥—É–º–∞—é –æ —Ç–µ–±–µ\n"
    "–∏ –æ—á–µ–Ω—å —Ç–µ–±—è –ª—é–±–ª—é üíò"
)

DAILY_TEXT = "–ü–æ–º–Ω–∏, —è —Ç–µ–±—è –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –ª—é–±–ª—é ‚ù§Ô∏èüíû"


async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id

    await context.bot.send_photo(
        chat_id=chat_id,
        photo=InputFile(PHOTO_PATH),
        caption=START_TEXT
    )

    context.application.chat_data[chat_id] = True


async def daily_message(context: ContextTypes.DEFAULT_TYPE):
    for chat_id in context.application.chat_data.keys():
        try:
            await context.bot.send_photo(
                chat_id=chat_id,
                photo=InputFile(PHOTO_PATH),
                caption=DAILY_TEXT
            )
        except:
            pass


async def main():
    app = ApplicationBuilder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))

    # ‚è∞ –≤—Ä–µ–º—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–º–æ–∂–µ–º –ø–æ–º–µ–Ω—è—Ç—å)
    app.job_queue.run_daily(
        daily_message,
        time=time(hour=10, minute=0)
    )

    await app.run_polling()


if __name__ == "__main__":
    asyncio.run(main())